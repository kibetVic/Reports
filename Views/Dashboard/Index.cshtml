@model Reports.Models.ViewModels.DashboardViewModel
@using System.Text.Json

@{
    ViewData["Title"] = "Dashboard";
}

<div class="container-fluid mt-4">
    <div class="container-fluid py-4">
        <div class="text-center mb-5">
            <h1 class="fw-bold display-6 text-primary">Payment & Disbursement Dashboard</h1>
            <p class="text-muted fs-6">Visual insights into payment performance, spending, and trends.</p>
        </div>

        <!-- Summary Cards -->
        <div class="row g-4 mb-5 text-center">
            <div class="col-md-3 col-6">
                <div class="card shadow-sm border-0 bg-primary text-white">
                    <div class="card-body p-3">
                        <h3 class="fw-bold">@Model.PaidCount</h3>
                        <p class="mb-0">Paid Transactions</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="card shadow-sm border-0 bg-danger text-white">
                    <div class="card-body p-3 text-center">
                        <h3 class="fw-bold">@Model.HallHireTotals.Sum().ToString("N2")</h3>
                        <p class="mb-0">Total Venue Transactions</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="card shadow-sm border-0 bg-success text-white">
                    <div class="card-body p-3">
                        <h3 class="fw-bold">@Model.TotalLeadFarmersSpending.ToString("N2")</h3>
                        <p class="mb-0">Lead Farmers Spending</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="card shadow-sm border-0 bg-info text-white">
                    <div class="card-body p-3">
                        <h3 class="fw-bold">@Model.TotalEASpending.ToString("N2")</h3>
                        <p class="mb-0">EA Spending</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="row g-4">
            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-header bg-light py-2">
                        <h6 class="mb-0 fw-semibold">🏢 Venue Breakdown — Mpesa, Farmers & EA Totals</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="venueBarChart" style="max-height:300px;"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-header bg-light py-2">
                        <h6 class="mb-0 fw-semibold">📈 Hall Hire Trends Over Time</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="hallHireLineChart" style="max-height:300px;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-4 mt-4">
            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-header bg-light py-2">
                        <h6 class="mb-0 fw-semibold">🍩 Payment Status — Paid vs Unpaid</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="statusDoughnutChart" style="max-height:280px;"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-12">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-header bg-light py-2">
                        <h6 class="mb-0 fw-semibold">🥧 Spending Split — Lead Farmers vs EA vs Hall Hire</h6>
                    </div>
                    <div class="card-body">
                        <canvas id="spendingPieChart" style="max-height:280px;"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const venueLabels = @Html.Raw(JsonSerializer.Serialize(Model.VenueLabels));
        const mpesaValues = @Html.Raw(JsonSerializer.Serialize(Model.TotalMpesaCharges));
        const farmerValues = @Html.Raw(JsonSerializer.Serialize(Model.TotalFarmers));
        const eaValues = @Html.Raw(JsonSerializer.Serialize(Model.TotalEA));

        const trendLabels = @Html.Raw(JsonSerializer.Serialize(Model.TrendMonths));
        const hallHireTotals = @Html.Raw(JsonSerializer.Serialize(Model.HallHireTotals));

        const paidCount = @Model.PaidCount;
        const unpaidCount = @Model.UnpaidCount;

        const leadFarmersSpending = @Model.TotalLeadFarmersSpending;
        const eaSpending = @Model.TotalEASpending;
        const hallHireSpending = @Model.TotalHallHireSpending;

        // 🏢 Bar Chart
        new Chart(document.getElementById("venueBarChart"), {
            type: 'bar',
            data: {
                labels: venueLabels,
                datasets: [
                    { label: 'Total Mpesa Charges', data: mpesaValues, backgroundColor: '#007bff' },
                    { label: 'Lead Farmers Total', data: farmerValues, backgroundColor: '#28a745' },
                    { label: 'EA Total', data: eaValues, backgroundColor: '#ffc107' }
                ]
            },
            options: {
                responsive: true,
                animation: false,
                plugins: {
                    tooltip: { enabled: true },
                    legend: { position: 'bottom' }
                },
                scales: { y: { beginAtZero: true } }
            }
        });

        // 📈 Line Chart
        new Chart(document.getElementById("hallHireLineChart"), {
            type: 'line',
            data: {
                labels: trendLabels,
                datasets: [{
                    label: 'Hall Hire Total',
                    data: hallHireTotals,
                    borderColor: '#17a2b8',
                    backgroundColor: 'rgba(23,162,184,0.15)',
                    tension: 0.2,
                    fill: false
                }]
            },
            options: {
                responsive: true,
                animation: false,
                plugins: { legend: { position: 'bottom' } },
                scales: { y: { beginAtZero: true } }
            }
        });

        // 🍩 Doughnut
        new Chart(document.getElementById("statusDoughnutChart"), {
            type: 'doughnut',
            data: {
                labels: ['Paid', 'Unpaid'],
                datasets: [{ data: [paidCount, unpaidCount], backgroundColor: ['#28a745', '#dc3545'] }]
            },
            options: {
                responsive: true,
                animation: false,
                plugins: { legend: { position: 'bottom' } }
            }
        });

        // 🥧 Pie
        new Chart(document.getElementById("spendingPieChart"), {
            type: 'pie',
            data: {
                labels: ['Lead Farmers', 'EA', 'Hall Hire'],
                datasets: [{
                    data: [leadFarmersSpending, eaSpending, hallHireSpending],
                    backgroundColor: ['#20c997', '#6610f2', '#ffc107']
                }]
            },
            options: {
                responsive: true,
                animation: false,
                plugins: { legend: { position: 'bottom' } }
            }
        });
    </script>
}
